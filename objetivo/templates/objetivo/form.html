{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">{% if form.instance.pk %}Editar{% else %}Crear{% endif %} Objetivo Profesional</h2>

    <form method="post" class="bg-white p-4 rounded shadow-sm">
        {% csrf_token %}

        <div class="mb-3">
            {{ form.titulo.label_tag }}
            {{ form.titulo }}
            {{ form.titulo.errors }}
        </div>

        <!-- CAMPO DINÁMICO DE DESCRIPCIÓN -->
        <div class="mb-3">
            <label class="form-label fw-bold">Descripción (puedes agregar varias líneas):</label>
            <div id="descripcion-dinamica-container">
                {% if form.descripcion_lineas %}
                {% for linea in form.descripcion_lineas %}
                <div class="input-group mb-2">
                    <input type="text" name="linea_descripcion" class="form-control descripcion-linea"
                        value="{{ linea }}">
                    <button type="button" class="btn btn-outline-danger" title="Eliminar línea"
                        onclick="this.parentElement.remove()">
                        <i class="bi bi-dash-circle"></i>
                    </button>
                </div>
                {% endfor %}
                {% else %}
                <div class="input-group mb-2">
                    <input type="text" name="linea_descripcion" class="form-control descripcion-linea"
                        placeholder="Ej: Logré una mejora en el sistema...">
                    <button type="button" class="btn btn-outline-success" title="Agregar línea"
                        onclick="agregarLinea()">
                        <i class="bi bi-plus-circle"></i>
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="text-end mt-2 mb-4">
                <button type="button" class="btn btn-sm btn-outline-primary" onclick="agregarLinea()">
                    <i class="bi bi-plus-circle me-1"></i> Agregar nueva línea
                </button>
            </div>

            <!-- MODO PRESENTACION justo debajo, relacionado con la descripción -->
            <label class="form-label fw-bold">Modo de Presentación</label>
            <div>
                {% for radio in form.modo_presentacion %}
                <div class="form-check form-check-inline">
                    {{ radio.tag }}
                    <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                </div>
                {% endfor %}
                {{ form.modo_presentacion.errors }}
            </div>

            <input type="hidden" name="descripcion" id="descripcion-final">
        </div>

        <div class="mb-3">
            {{ form.icono.label_tag }}
            {{ form.icono }}
            {{ form.icono.errors }}
        </div>

        <div class="mb-3">
            {{ form.link.label_tag }}
            {{ form.link }}
            {{ form.link.errors }}
        </div>

        <div class="mb-3">
            {{ form.orden.label_tag }}
            {{ form.orden }}
            {{ form.orden.errors }}
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save me-1"></i> Guardar
            </button>
            <a href="{% url 'objetivo_list' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left-circle me-1"></i> Cancelar
            </a>
        </div>
    </form>
</div>

<script>
    function agregarLinea() {
        const container = document.getElementById('descripcion-dinamica-container');
        const nuevaInput = document.createElement('div');
        nuevaInput.classList.add('input-group', 'mb-2');
        nuevaInput.innerHTML = `
            <input type="text" name="linea_descripcion" class="form-control descripcion-linea" placeholder="Otra línea de descripción...">
            <button type="button" class="btn btn-outline-danger" title="Eliminar línea" onclick="this.parentElement.remove()">
                <i class="bi bi-dash-circle"></i>
            </button>
        `;
        container.appendChild(nuevaInput);
    }

    document.querySelector('form').addEventListener('submit', function (e) {
        const lineas = document.querySelectorAll('.descripcion-linea');
        const contenido = Array.from(lineas)
            .map(input => input.value.trim())
            .filter(linea => linea.length > 0)
            .join('\n');
        document.getElementById('descripcion-final').value = contenido;
    });
</script>
{% endblock %}